<p>
  <a href="http://research.inplanb.com/has_ancestor">has_ancestor</a> is a Ruby on rails plugin that enables the specification 
  of inheritance relations between ActiveRecord models. Currently in Rails this functionality is only available in
  <a href="http://wiki.rubyonrails.org/rails/pages/SingleTableInheritance">Single Table Inheritance</a>. 
  Single Table Inheritance requires that all models in an inheritance hierarchy be in the same table, which is acceptable if the number of
  models in the hierarchy is small. For inheritance hierarchies that contain a large or unknown number of models more complex 
  representations of inheritance relations, such as <a href="http://www.martinfowler.com/eaaCatalog/classTableInheritance.html">
  Class Table Inheritance</a>, are required. has_ancestor provides and implementation of Class Table Inheritance based on rails 
  <a href="http://wiki.rubyonrails.org/rails/pages/UnderstandingPolymorphicAssociations">Polymorphic Associations</a>. This differs from
  the implementation used in the <a href="http://rubyforge.org/projects/clti/">Class Table Inheritance Plugin</a>, which uses database
  views. 
</p>
<p>  
  In this article an example implementation of has_ancestor will be presented that illustrates its most important features. 
  In Release 0.0.0 there are some limitations in usage, which are discussed, but that are not prohibitive.    
</p>
<h3>Define</h3>
<p>
  The example is a simple representation of a line item in a purchase. It consists of three models. 
  The first, <code>item_purchase</code>, is the root of the inheritance hierarchy. It has two
  descendant models, <code>stock_item_purchase</code> and <code>contract_item_purchase</code>. The migration for the model
  is shown below. 
</p>
<p>
<typo:code lang="ruby">

  class CreateHasAncestorModel < ActiveRecord::Migration

    def self.up

      create_table :item_purchases, :force => true, \
      :primary_key => :item_purchase_id do |t|
        t.column :item_purchase_descendant_id, :integer
        t.column :item_purchase_descendant_type, :string
        t.column :closed, :integer, :default => 0
        t.column :item, :string
        t.column :unit_cost, :integer
        t.column :unit_count, :integer
        t.column :cost, :integer      
      end
     
      create_table :stock_item_purchases, \
      :force => true, \
      :primary_key => :stock_item_purchase_id  do |t|
        t.column :in_inventory, :integer, :default => 0
      end
  
      create_table :contract_item_purchases, \
      :force => true, \
      :primary_key => :contract_item_purchase_id  do |t|
        t.column :length, :integer
      end
      
    end
    
    def self.down
    
      drop_table :item_purchases
      drop_table :stock_item_purchases
      drop_table :contract_item_purchases
  
    end
    
  end
  

</typo:code>
</p>
<p>
      <table class="definitions">
        <tr>
          <td class="term"><code>item_purchase_id</code></td>
          <td class="definition">
            <p>Return ancestor model instance. If model has no ancestor return <code><strong>nil</strong></code>.</p>
          </td>
        </tr>
      </table>
  
</p>
<p>
<typo:code lang="ruby">

  class ItemPurchase < ActiveRecord::Base
  
     has_descendants
         
     def close_item_purchase
       self.cost = self.unit_count * self.unit_cost
       self.closed = 1      
     end
     
  end
  
</typo:code>
</p>
<p>
<typo:code lang="ruby">

  class StockItemPurchase < ActiveRecord::Base
  
     has_ancestor :named => :item_purchase
     
  end
  
</typo:code>
</p>
<p>
<typo:code lang="ruby">

  class ContractItemPurchase < ActiveRecord::Base
  
     has_ancestor :named => :item_purchase
  
     def close_item_purchase
       self.cost = self.length * self.unit_count * 
         self.unit_cost
       self.closed = 1      
     end
     
  end
  
</typo:code>
</p>
<h3>Use</h3>
<p>
<typo:code lang="ruby">

    stock_item = StockItemPurchase(:item=>'keyboard', :unit_cost=>'300', :unit_count=>'1')

</typo:code>
</p>
<p>
<typo:code lang="ruby">

    stock_item.in_inventory = 1
    stock_item.closed = 1

</typo:code>
</p>
<p>
<typo:code lang="ruby">

    ItemPurchase.find_by_closed(0).each do |item|
      item.to_descendant.close_item_purchase
      item.to_descendant.save
    end


</typo:code>
</p>
<h3>Limitations</h3>
<p>
</p>

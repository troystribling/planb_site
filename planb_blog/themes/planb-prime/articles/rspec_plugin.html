<p>
  Testing a Rails plugin requires that it be implemented in a test   
  application. <a href="http://www.pluginaweek.org/2006/11/24/plugin-tip-of-the-week-testing-your-plugins-the-right-way/" target="blank">PluginAWeek</a> describes how to accomplish this 
  by embedding a test application in the plugin. Building on this, 
  here <a href="http://rspec.rubyforge.org/index.html" target="blank">RSpec</a> is installed in the test application so that 
  <a href="http://en.wikipedia.org/wiki/Behavior_driven_development" target="blank">Behavior Driven Development</a> may be used for plugin   
  development.
</p>
<p>
  All of the code examples presented here are from the  
  <a href="http://research.inplanb.com/has_ancestor">has_ancestor</a>   
  Ruby on Rails plugin. 
</p>
<h3>Install</h3>
<p>
  Begin by building a Rails test application as described in <a href="http://www.pluginaweek.org/2006/11/24/plugin-tip-of-the-week-testing-your-plugins-the-right-way/" target="blank">PluginAWeek</a>. 
  Install both the <a href="http://rspec.rubyforge.org/documentation/rails/install.html" target="blank">RSpec and Rspec Rails</a> plugins in the test 
application.
</p>
<p>
<typo:code>

  ruby script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec
  ruby script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec_on_rails


</typo:code>
</p>
<p>
  Next, bootstrap Rspec.
</p>
<p>
<typo:code>

  ruby script/generate rspec


</typo:code>
</p>

<h3>Configure</h3>
<p>
  There are two ways to configure RSpec. For one 
  configuration specs are run from <code>$RAILS_ROOT</code> 
  of the test application. In the other specs are run from
  the top level directory of the plugin. The first 
  configuration would not differ from using RSpec in a normal Rails
  application. The second configuration will be described in the 
  remainder of this section.
</p>
<p>
  Create a directory called <code>spec</code> in the plugin
  <code>test</code> 
  directory. Copy <code>spec_helper.rb</code> from the Rails test
  application to <code>test/spec</code>. The 
  modified <code>spec_helper.rb</code> from
  <a href="http://research.inplanb.com/has_ancestor">has_ancestor</a> 
  is shown.
</p>
<p>
<typo:code>

  ENV["RAILS_ENV"] ||= "test"
  require "#{File.dirname(__FILE__)}/../rails_root/config/environment.rb"
  require "#{RAILS_ROOT}/vendor/plugins/01_rspec_on_rails/lib/spec/rails"
  silence_warnings { RAILS_ENV = ENV['RAILS_ENV'] }
  ActiveRecord::Migrator.migrate("#{RAILS_ROOT}/db/migrate")

  Spec::Runner.configure do |config|
    config.use_transactional_fixtures = true
    config.use_instantiated_fixtures  = false
    config.fixture_path = File.dirname(__FILE__) + "/../fixtures/"
  end


</typo:code>
</p>
<p>
  Add the following <code>require</code> and 
  <code>Spec::Rake::SpecTask</code> to the plugin
  <code>Rakefile</code>
</p>
<p>
<typo:code>

  require 'test/rails_root/vendor/plugins/00_rspec/lib/spec/rake/spectask'


</typo:code>
</p>
<p>
<typo:code>

  desc "Run all plugin specs"
  Spec::Rake::SpecTask.new(:spec) do |t|
    t.spec_files = FileList['test/spec/specs/**/*_spec.rb']
    t.spec_opts = ['--options', 'test/spec/spec.opts']
  end


</typo:code>
</p>

<h3>Use</h3>
<p>
  To run the plugin specs issue the following command from the 
  plugin directory.
</p>
<p>
<typo:code>

  rake spec


</typo:code>
</p>

